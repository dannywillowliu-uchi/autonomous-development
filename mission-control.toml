[target]
name = "autonomous-dev-scheduler"
path = "/Users/dannyliu/personal_projects/autonomous-development"
branch = "main"
objective = """Implement P2 (Architect/Editor Model Split) and P3 (Structured Schedule Output for Planner). Both improve worker quality and planner reliability.

1. PER-COMPONENT MODEL CONFIG: Add per-component model fields to config.py: planner_model, worker_model, fixup_model. Each defaults to "opus" but can be overridden in mission-control.toml under a [models] section. Update recursive_planner.py, worker.py, and green_branch.py to read their model from config instead of using the global scheduler.model. Add tests for config parsing with and without the [models] section.

2. ARCHITECT/EDITOR SPLIT IN WORKERS: Add an optional two-pass mode for workers. When enabled (architect_editor_mode = true in config), the worker runs two Claude sessions per unit: (a) Architect pass -- "Analyze the codebase and describe exactly what changes are needed, which files to modify, and why. Do NOT write code." Uses the worker_model. (b) Editor pass -- "Implement these specific changes: {architect_output}". Uses the worker_model. The architect output is passed as context to the editor. If architect_editor_mode is false (default), workers behave as today -- single pass. Add the mode flag to config.py. Modify worker.py to support both modes. Add tests for both paths.

3. STRUCTURED PLANNER OUTPUT: Change recursive_planner.py to use embedded structured blocks instead of parsing the entire LLM response. The planner prompt should instruct the LLM to reason in prose first, then emit a machine-readable block: <!-- PLAN -->{"units": [{"title": "...", "scope": "...", "files_hint": "..."}]}<!-- /PLAN -->. Update the parser to extract only the <!-- PLAN --> block using regex, ignoring surrounding prose. Fall back to the current parsing if no <!-- PLAN --> block is found (backwards compatibility). The MC_RESULT pattern in session.py already uses a similar approach -- follow that pattern.

4. PLANNER OUTPUT TESTS: Add comprehensive tests for the new structured parser: valid plan block extraction, missing plan block fallback, malformed JSON inside block, multiple plan blocks (use first), plan block with surrounding prose. Test that existing planner output formats still work via fallback.

Each unit: implement the feature, add tests, ensure all existing tests pass. Read BACKLOG.md for the full P2 and P3 specs."""

[target.verification]
command = ".venv/bin/python -m pytest -q && .venv/bin/ruff check src/ tests/"
timeout = 300

[scheduler]
session_timeout = 2700
cooldown = 5
max_sessions_per_run = 50
model = "opus"
monitor_interval = 5
output_summary_max_chars = 4000

[scheduler.git]
strategy = "branch-per-session"
auto_merge = false

[scheduler.budget]
max_per_session_usd = 10.0
max_per_run_usd = 500.0

[scheduler.parallel]
num_workers = 2
pool_dir = "/Users/dannyliu/personal_projects/.mc-pool-ads"
warm_clones = 2

[rounds]
max_rounds = 20
stall_threshold = 5
cooldown_between_rounds = 5
max_discovery_chars = 4000
max_discoveries_per_round = 10
max_summary_items = 5
timeout_multiplier = 1.5
stall_score_epsilon = 0.01

[planner]
max_depth = 2
max_children_per_node = 5
budget_per_call_usd = 2.0

[continuous]
max_wall_time_seconds = 14400
backlog_min_size = 1
timeout_multiplier = 1.5

[green_branch]
working_branch = "mc/working"
green_branch = "mc/green"
fixup_max_attempts = 5
auto_push = true
push_branch = "main"

[discovery]
enabled = true
tracks = ["feature", "quality", "security"]
max_items_per_track = 3
min_priority_score = 3.0
model = "opus"
budget_per_call_usd = 5.0
research_enabled = true
research_model = "sonnet"
research_parallel_queries = 3

[heartbeat]
interval = 300
idle_threshold = 3

[notifications.telegram]
# bot_token and chat_id read from env vars TELEGRAM_BOT_TOKEN / TELEGRAM_CHAT_ID
on_heartbeat = true
on_merge_fail = true
on_mission_end = true

[backend]
type = "local"
