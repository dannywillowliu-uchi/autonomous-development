{
  "objective": "Implement the following improvements:\n\n## Features\n- Add MC_RESULT schema validation with degraded parsing: Define Pydantic model for MC_RESULT structure (status: Literal[completed|failed|blocked], commits: list[str], summary: str, files_changed: list[str], discoveries: list[str], concerns: list[str]). In session.py parse_mc_result and worker.py _build_handoff, validate against schema. On validation error, extract valid fields and log warning instead of treating as parse failure. Add test_mc_result_schema_validation with malformed inputs.\n  Files: src/mission_control/session.py, src/mission_control/worker.py, src/mission_control/models.py, tests/test_session.py\n- Add heartbeat recovery actions for idle stalls: When Heartbeat.check() detects consecutive_idle >= idle_threshold, trigger recovery before stopping: (1) dump active unit states to logs, (2) send diagnostic Telegram message with stuck units, (3) offer to kill stuck workers and retry. Add HeartbeatConfig.enable_recovery (default True) and .recovery_actions list. Modify continuous_controller.py dispatch loop to invoke recovery before setting stopped_reason='heartbeat_stalled'.\n  Files: src/mission_control/heartbeat.py, src/mission_control/continuous_controller.py, tests/test_heartbeat.py\n- Add streaming Telegram notifications with backpressure: Replace synchronous urllib Telegram calls in notifier.py with async httpx client. Current implementation uses asyncio.to_thread() which can exhaust thread pool under high notification load. Add message batching (collect notifications over 5s window, send as single message) and backpressure handling (drop low-priority notifications when queue > 100). Preserve existing send_mission_start/send_mission_end/send_merge_conflict API.\n  Files: src/mission_control/notifier.py, tests/test_notifier.py\n\n## Code Quality\n- Add database transaction rollback for failed merge operations: Wrap green_branch.py merge_unit() and continuous_controller.py completion processor merge path (lines 481-546) in try/finally with explicit rollback on failure. Create Database.transaction() context manager that begins/commits/rollback. Currently failed merges leave work_units table in 'running' state with commit_hash set but merge never happened. Add unit_events row for 'merge_failed' event type.\n  Files: src/mission_control/db.py, src/mission_control/green_branch.py, src/mission_control/continuous_controller.py, tests/test_green_branch.py\n- Add test coverage for concurrent merge conflicts: Create test_parallel_merge_conflicts in test_green_branch.py that spawns 3 workers modifying same file simultaneously. Verify that green_branch.py merge_unit() correctly detects conflicts, only one merge succeeds, and losers get retried with failure context. Add assertion that mc/green advances monotonically (no force-push or reset). Mock GreenBranchManager._run_git to simulate realistic conflict scenarios.\n  Files: tests/test_green_branch.py, tests/test_parallel_integration.py\n- Add structured error context to discovery subprocess failures: In auto_discovery.py _run_discovery_subprocess (line 150+), capture stderr separately from stdout. Parse Claude Code error types (timeout, budget exceeded, permission denied, workspace corruption). Return DiscoveryResult with error_type and error_detail fields. Log full subprocess command, working directory, exit code, and first 500 chars of stderr when discovery fails. Add test_discovery_subprocess_errors with mocked failures.\n  Files: src/mission_control/auto_discovery.py, src/mission_control/models.py, tests/test_auto_discovery.py\n\n## Security/Reliability\n- Add worker subprocess output size limits: In backends/local.py get_output() (line 116), track cumulative stdout size per worker. Truncate if exceeds 50MB (add BackendConfig.max_output_mb). Currently _stdout_bufs can grow unbounded if worker output loops or dumps large files. Add warning log at 10MB, 25MB, 50MB. Kill worker subprocess when limit reached. Store truncation event in unit_events table. Add test_worker_output_overflow.\n  Files: src/mission_control/backends/local.py, src/mission_control/backends/base.py, src/mission_control/config.py, tests/test_backends.py\n- Add rate limiting to Telegram notifier API calls: Telegram Bot API has 30 msg/second rate limit. Add asyncio.Semaphore(30) in TelegramNotifier.__init__ and acquire/release around _send_sync. Track send timestamps in collections.deque, sleep if > 30 sends in last 1 second. Add NotificationConfig.telegram_rate_limit (default 25 to leave headroom). Log rate limit violations as warnings. Add test_telegram_rate_limiting that sends 100 messages and verifies < 30/sec.\n  Files: src/mission_control/notifier.py, src/mission_control/config.py, tests/test_notifier.py\n- Validate numeric config ranges on load: Add __post_init__ validators to all config dataclasses in config.py. Enforce: num_workers (1-20), max_wall_time_seconds (60-86400), heartbeat.interval (30-3600), planner.max_depth (1-5), continuous.retry_max_delay_seconds (1-3600), budget.max_per_session_usd (0.01-100). Raise ValueError with helpful message on invalid values. Add test_config_validation_ranges.\n  Files: src/mission_control/config.py, tests/test_config.py\n",
  "outcome": {
    "objective_met": true,
    "stopped_reason": "planner_completed"
  },
  "mission_id": "22fe9467406b",
  "units_dispatched": 11,
  "units_merged": 8,
  "units_failed": 0,
  "wall_time_seconds": 4566.584803332924,
  "total_cost_usd": 46.23374565,
  "files_changed": [
    "pyproject.toml",
    "src/mission_control/auto_discovery.py",
    "src/mission_control/backends/local.py",
    "src/mission_control/config.py",
    "src/mission_control/continuous_controller.py",
    "src/mission_control/db.py",
    "src/mission_control/green_branch.py",
    "src/mission_control/heartbeat.py",
    "src/mission_control/models.py",
    "src/mission_control/notifier.py",
    "src/mission_control/session.py",
    "src/mission_control/worker.py",
    "tests/test_auto_discovery.py",
    "tests/test_backends.py",
    "tests/test_config.py",
    "tests/test_green_branch.py",
    "tests/test_heartbeat.py",
    "tests/test_notifier.py",
    "tests/test_parallel_integration.py",
    "tests/test_session.py"
  ],
  "verification_passed": false,
  "verification_output": "/bin/sh: .venv/bin/python: No such file or directory\n",
  "timeline": [
    {
      "timestamp": "2026-02-15T05:51:20.919217+00:00",
      "event_type": "dispatched",
      "work_unit_id": "b35504ffb9b6",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T05:54:22.177361+00:00",
      "event_type": "dispatched",
      "work_unit_id": "90b56b5bc90a",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T05:54:23.183894+00:00",
      "event_type": "merged",
      "work_unit_id": "b35504ffb9b6",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T05:58:49.178640+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "90b56b5bc90a",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix conflicts and then commit the result.\\n\"}"
    },
    {
      "timestamp": "2026-02-15T05:58:49.183803+00:00",
      "event_type": "dispatched",
      "work_unit_id": "4395b687d671",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:01:45.787596+00:00",
      "event_type": "dispatched",
      "work_unit_id": "5e9caed0a6c9",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:01:45.840786+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "4395b687d671",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix conflicts and then commit the result.\\n\"}"
    },
    {
      "timestamp": "2026-02-15T06:07:18.234769+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "5e9caed0a6c9",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging pyproject.toml\\nCONFLICT (content): Merge conflict in pyproject.toml\\nAutomatic merge failed; fix conflicts and then commit the result.\\n\"}"
    },
    {
      "timestamp": "2026-02-15T06:10:49.746905+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "90b56b5bc90a",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix conflicts and then commit the result.\\n\"}"
    },
    {
      "timestamp": "2026-02-15T06:10:49.756799+00:00",
      "event_type": "dispatched",
      "work_unit_id": "13796d9f2dc8",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:14:27.534768+00:00",
      "event_type": "merged",
      "work_unit_id": "13796d9f2dc8",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:16:58.043805+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "4395b687d671",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix conflicts and then commit the result.\\n\"}"
    },
    {
      "timestamp": "2026-02-15T06:21:50.496090+00:00",
      "event_type": "dispatched",
      "work_unit_id": "cbd201fc7bd3",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:21:51.412199+00:00",
      "event_type": "merged",
      "work_unit_id": "5e9caed0a6c9",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:24:32.733077+00:00",
      "event_type": "merged",
      "work_unit_id": "cbd201fc7bd3",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:29:03.524020+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "90b56b5bc90a",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix conflicts and then commit the result.\\n\"}"
    },
    {
      "timestamp": "2026-02-15T06:33:45.208084+00:00",
      "event_type": "dispatched",
      "work_unit_id": "4c5ddb4335ba",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:33:45.930152+00:00",
      "event_type": "merged",
      "work_unit_id": "4395b687d671",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:38:28.117500+00:00",
      "event_type": "merged",
      "work_unit_id": "4c5ddb4335ba",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:42:48.834410+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "90b56b5bc90a",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/config.py\\nAuto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix c\"}"
    },
    {
      "timestamp": "2026-02-15T06:42:48.849030+00:00",
      "event_type": "dispatched",
      "work_unit_id": "12b7cbc9dedb",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:46:55.828839+00:00",
      "event_type": "dispatched",
      "work_unit_id": "addf3f5fb984",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:46:56.569064+00:00",
      "event_type": "merged",
      "work_unit_id": "12b7cbc9dedb",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:50:27.898822+00:00",
      "event_type": "merged",
      "work_unit_id": "addf3f5fb984",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:54:44.298777+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "90b56b5bc90a",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/config.py\\nAuto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix c\"}"
    },
    {
      "timestamp": "2026-02-15T06:54:44.308453+00:00",
      "event_type": "dispatched",
      "work_unit_id": "f07a32f15c3a",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T06:59:01.140347+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "f07a32f15c3a",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/config.py\\nCONFLICT (content): Merge conflict in src/mission_control/config.py\\nAutomatic merge failed; fix conflicts and then commit the result.\\n\"}"
    },
    {
      "timestamp": "2026-02-15T07:02:57.602072+00:00",
      "event_type": "dispatched",
      "work_unit_id": "40bb97ea1348",
      "details": ""
    },
    {
      "timestamp": "2026-02-15T07:02:57.666282+00:00",
      "event_type": "retry_queued",
      "work_unit_id": "90b56b5bc90a",
      "details": "{\"delay\": 15.0, \"failure_reason\": \"Merge conflict: Auto-merging src/mission_control/config.py\\nAuto-merging src/mission_control/notifier.py\\nCONFLICT (content): Merge conflict in src/mission_control/notifier.py\\nAuto-merging tests/test_notifier.py\\nCONFLICT (content): Merge conflict in tests/test_notifier.py\\nAutomatic merge failed; fix c\"}"
    }
  ]
}
